{% extends 'base2.html' %}
{% load static %}
{% block content %}
      <!--  Header End -->
      <div class="container-fluid">
        <!--  Row 1 -->
        <div class="row">
          <div class="col-lg-8 d-flex align-items-stretch">
            <div class="card w-100">
              <div class="card-body">
                <h5 class="card-title mb-9 fw-semibold">Registrations / Month</h5>
                  <canvas id="registrationChart" width="400" height="200"></canvas> <!-- Chart Canvas -->
              </div>
            </div>
          </div>
          
          <!-- Include Chart.js -->
          <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        
          
          
          <!-- Include Chart.js -->
          <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
          
          <script>
            // Get the labels and data from the template context
            var labels = {{ labels|safe }};  // List of month names
            var data = {{ data|safe }};      // List of registration counts
          
            // Chart.js setup
            var ctx = document.getElementById('registrationChart').getContext('2d');
            var registrationChart = new Chart(ctx, {
              type: 'bar', // Bar chart
              data: {
                labels: labels,  // Months
                datasets: [{
                  label: 'Number of Registrations',
                  data: data,  // Registration counts
                  backgroundColor: 'rgba(54, 162, 235, 0.5)', // Bar color
                  borderColor: 'rgba(54, 162, 235, 1)',       // Border color
                  borderRadius: 50
                }]
              },
              options: {
                scales: {
                  y: {
                    beginAtZero: true,  // Start y-axis at zero
                    ticks: {
                      stepSize: 1        // Step size for y-axis ticks
                    }
                  }
                }
              }
            });
          </script>
          
          <div class="col-lg-4">
            <div class="row">
              <div class="col-lg-12">
                <!-- Yearly Breakup -->
                <div class="card overflow-hidden">
                    <div class="card-body p-4">
                        <h5 class="card-title mb-9 fw-semibold">Enrollments / Course</h5>
                        <div class="row align-items-center">

                            <div class="col-12">
                                <div class="d-flex justify-content-center">
                                    <canvas id="breakup" width="400" height="200"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Include Chart.js -->
            <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
            <script>
                var ctx = document.getElementById('breakup').getContext('2d');
            
                // Prepare the chart data
                var courseLabels = {{ course_labels|safe }};
                var courseData = {{ course_data|safe }};
            
                // Create the donut chart
                var breakupChart = new Chart(ctx, {
                    type: 'doughnut', // Set to donut chart
                    data: {
                        labels: courseLabels,  // Course names
                        datasets: [{
                            label: 'Enrollments by Course',
                            data: courseData,  // Enrollment counts
                            backgroundColor: [
                                'rgba(255, 99, 132, 0.6)',
                                'rgba(54, 162, 235, 0.6)',
                                'rgba(255, 206, 86, 0.6)',
                                'rgba(75, 192, 192, 0.6)',
                                'rgba(153, 102, 255, 0.6)',
                                'rgba(255, 159, 64, 0.6)',
                            ],
                            borderColor: [
                                'rgba(255, 99, 132, 1)',
                                'rgba(54, 162, 235, 1)',
                                'rgba(255, 206, 86, 1)',
                                'rgba(75, 192, 192, 1)',
                                'rgba(153, 102, 255, 1)',
                                'rgba(255, 159, 64, 1)',
                            ],
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: {
                                position: 'top', // Position of the legend
                            }
                        }
                    }
                });
            </script>
            
            <div class="card">
              <div class="card-body">
                  <h5 class="card-title">Student Progress</h5>
                  <canvas id="studentProgressChart"></canvas>
              </div>
          </div>
          
          <script>
            document.addEventListener('DOMContentLoaded', function() {
                const ctx = document.getElementById('studentProgressChart').getContext('2d');
                
                const labels = {{ labels|safe }};  // Pass your labels from the Django context
                const data = {{ progress_data|safe }};  // Pass your student progress data from the Django context
                
                const studentProgressChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Student Progress',
                            data: data,
                            fill: false,
                            borderColor: 'rgba(75, 192, 192, 1)',
                            tension: 0.1
                        }]
                    },
                    options: {
                        scales: {
                            y: {
                                beginAtZero: true
                            }
                        }
                    }
                });
            });
        </script>
        
          
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-4 d-flex align-items-stretch">
            <div class="card w-100">
                <div class="card-body p-4">
                    <div class="mb-4">
                        <h5 class="card-title fw-semibold">Categories</h5>
                        <a href="{% url 'category_list' %}" >Sell All</a>
                    </div>
                    <ul class="timeline-widget mb-0 position-relative mb-n5">
                        {% for category in categories %}
                            <li class="timeline-item d-flex position-relative overflow-hidden">
                                <div class="timeline-time text-dark flex-shrink-0 text-end">{{ forloop.counter }}</div>
                                <div class="timeline-desc fs-3 text-dark mt-n1"><strong>{{ category.name }}</strong></div>
                            </li>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
        
        <div class="col-lg-8 d-flex align-items-stretch">
          <div class="card w-100">
              <div class="card-body p-4">
                  <h5 class="card-title fw-semibold mb-4 mt-5">Last 5 Courses</h5>
                  <a href="{% url 'course_list' %}" >Sell All</a>

                  <div class="table-responsive">
                      <table class="table text-nowrap mb-0 align-middle">
                          <thead class="text-dark fs-4">
                              <tr>
                                  <th class="border-bottom-0">
                                      <h6 class="fw-semibold mb-0">#</h6>
                                  </th>
                                  <th class="border-bottom-0">
                                      <h6 class="fw-semibold mb-0">Course Name</h6>
                                  </th>
                                  <th class="border-bottom-0">
                                      <h6 class="fw-semibold mb-0">Category</h6>
                                  </th>
                                  <th class="border-bottom-0">
                                      <h6 class="fw-semibold mb-0">Created On</h6>
                                  </th>
                              </tr>
                          </thead>
                          <tbody>
                              {% for course in last_courses %}
                              <tr>
                                  <td class="border-bottom-0"><h6 class="fw-semibold mb-0">{{ forloop.counter }}</h6></td>
                                  <td class="border-bottom-0">
                                      <h6 class="fw-semibold mb-1">{{ course.course_name }}</h6>
                                  </td>
                                  <td class="border-bottom-0">
                                      <p class="mb-0 fw-normal">{{ course.category.name }}</p>
                                  </td>
                                  <td class="border-bottom-0">
                                      <p class="mb-0 fw-normal">{{ course.created_at|date:"Y-m-d" }}</p>  <!-- Adjust the date format as needed -->
                                  </td>
                              </tr>
                              {% empty %}
                              <tr>
                                  <td colspan="4" class="border-bottom-0 text-center"><p class="mb-0 fw-normal">No courses available.</p></td>
                              </tr>
                              {% endfor %}
                          </tbody>
                      </table>
                  </div>
              </div>
          </div>
      </div>
      
        </div>
        <div class="col-lg-8 d-flex align-items-stretch"></div>
          <div class="card w-100">
              <div class="card-body p-4">
                  <h5 class="card-title fw-semibold mb-4 mt-5">Students</h5>
                  <a href="{% url 'student_list' %}" >Sell All</a>

                  <div class="table-responsive">
                      <table class="table text-nowrap mb-0 align-middle">
                          <thead class="text-dark fs-4">
                              <tr>
                                  <th class="border-bottom-0">
                                      <h6 class="fw-semibold mb-0">#</h6>
                                  </th>
                                  <th class="border-bottom-0">
                                      <h6 class="fw-semibold mb-0">Student Name</h6>
                                  </th>
                                  <th class="border-bottom-0">
                                      <h6 class="fw-semibold mb-0">email</h6>
                                  </th>
                                  <th class="border-bottom-0">
                                    <h6 class="fw-semibold mb-0">D-O-B</h6>
                                </th>
                                  <th class="border-bottom-0">
                                      <h6 class="fw-semibold mb-0">Created On</h6>
                                  </th>
                              </tr>
                          </thead>
                          <tbody>
                              {% for student in last_students %}
                              <tr>
                                  <td class="border-bottom-0"><h6 class="fw-semibold mb-0">{{ forloop.counter }}</h6></td>
                                  <td class="border-bottom-0">
                                      <h6 class="fw-semibold mb-1">{{ student.full_name }}</h6>
                                  </td>
                                  <td class="border-bottom-0">
                                      <p class="mb-0 fw-normal">{{ student.email }}</p>
                                  </td>
                                  <td class="border-bottom-0">
                                    <p class="mb-0 fw-normal">{{ student.date_of_birth }}</p>
                                </td>
                                  <td class="border-bottom-0">
                                      <p class="mb-0 fw-normal">{{ student.created_on|date:"Y-m-d" }}</p>  <!-- Adjust the date format as needed -->
                                  </td>
                              </tr>
                              {% empty %}
                              <tr>
                                  <td colspan="4" class="border-bottom-0 text-center"><p class="mb-0 fw-normal">No courses available.</p></td>
                              </tr>
                              {% endfor %}
                          </tbody>
                      </table>
                  </div>
              </div>
          </div>

      {% endblock %}
